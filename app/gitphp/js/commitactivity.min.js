/*
 * GitPHP
 * 
 * @author Christopher Han <xiphux@gmail.com>
 * @copyright Copyright (c) 2012 Christopher Han
 * @package GitPHP
 * @subpackage Javascript
 */
define("modules/geturl",["module"],function(a){return a.config().baseurl});define("modules/getproject",["module"],function(a){return a.config().project||null});
define("modules/commitactivitygraph",["modules/geturl","modules/getproject","d3"],function(a,e){var h=null,f=null,d=null,c=null,b=null,o=null,g=null,p=null,i=null,m=null,q=null,r=null,j=null,k=null,s=null,n=function(a){m=k==i.length?i.slice(j):i.slice(j,k);c.domain([m[0].x,m[m.length-1].x]);g.transition().duration(500).select(".xaxis").call(q);var e=p.selectAll("rect").data(m,function(a){return a.x.getTime()});e.enter().append("rect").attr("class","bar").attr("fill","steelblue").attr("width",20).style("opacity",
0).attr("x",function(b){return a==1?c(b.x)-60.5:a==2?c(b.x)+59.5:c(b.x)-0.5}).attr("height",0).on("mouseover",function(a){var b=d3.time.format("%B %Y")(a.x),a=a.y+" commits";f.transition().duration(500).style("opacity",1).text(b);d.transition().duration(500).style("opacity",1).text(a);h.transition().duration(500).style("opacity",1)}).on("mouseout",function(){f.transition().duration(500).style("opacity",0);d.transition().duration(500).style("opacity",0);h.transition().duration(500).style("opacity",
0)});e.transition().duration(500).attr("x",function(a){return c(a.x)-0.5}).attr("height",function(a){return 500-b(a.y)}).style("opacity",1);e.exit().transition().duration(500).attr("height",0).attr("x",function(a){return c(a.x)-0.5}).style("opacity",0).remove()};return{init:function(l){c=d3.time.scale().range([10,950]);b=d3.scale.linear().range([500,0]);s=d3.select(l).append("div").style("text-align","center").style("padding-top","10px").style("width","960px").style("height","20px").style("opacity",
0);g=d3.select(l).append("svg").attr("width",1020).attr("height",560);p=g.append("g").attr("transform","translate(20,520)scale(1,-1)");l=g.append("g");h=l.append("rect").attr("width",150).attr("height",70).attr("x",405).attr("y",95).attr("stroke","#EDECE6").attr("stroke-width",1).attr("fill","white").style("opacity",0);f=l.append("text").attr("font-size","16").attr("text-anchor","middle").attr("dx",480).attr("dy",125).text("Loading commits...");d=l.append("text").attr("font-size","16").attr("text-anchor",
"middle").attr("dx",480).attr("dy",145).style("opacity",0);d3.json(a+"?p="+e+"&a=graphdata&g=commitactivity",function(a){a.forEach(function(a){a.CommitEpoch=new Date(a.CommitEpoch*1E3)});var d=d3.extent(a,function(a){return a.CommitEpoch});d[1].setMonth(d[1].getMonth()+2);d3.time.months(d[0],d[1]);o=d3.layout.histogram().value(function(a){return a.CommitEpoch}).range(d).bins(d3.time.months(d[0],d[1]));i=o(a);j=i.length-15;k=i.length;b.domain([0,d3.max(i,function(a){return a.y})]);f.transition().duration(500).style("opacity",
0);q=d3.svg.axis().scale(c).ticks(d3.time.months,1).orient("bottom");g.append("g").attr("class","xaxis").attr("transform","translate(30,520)");r=d3.svg.axis().scale(b).ticks(10).orient("right");g.append("g").attr("class","yaxis").attr("transform","translate(990,20)").call(r);s.transition().duration(500).text("<- Use the arrow keys to navigate ->").style("opacity",1);n();d3.select(window).on("keydown",function(){d3.event.keyCode==37?j>0&&(k--,j--,n(1)):d3.event.keyCode==39&&k<i.length&&(k++,j++,n(2))})})}}});
define("modules/lang",["jquery"],function(){return function(a){a.find("select").change(function(){a.find("form").submit()});a.find('input[type="submit"]').remove()}});define("modules/snapshotformats",["module"],function(a){return a.config().formats||null});define("modules/resources",["module"],function(a){return a.config().resources});
define("modules/tooltip.snapshot",["jquery","modules/snapshotformats","modules/resources"],function(a,e,h){function f(a){var c="<div>"+h.Snapshot+": ",b=!0,f=a.indexOf("/snapshot")!=-1,g;for(g in e)e.hasOwnProperty(g)&&(b||(c+=" | "),f?(b=a.replace("/snapshot","/"+g),c+='<a href="'+b+'">'+e[g]+"</a>"):c+='<a href="'+a+"&fmt="+g+'">'+e[g]+"</a>",b=!1);c+="</div>";return c}return function(d){d&&d.size()>0&&require(["qtip"],function(){d.each(function(){var c=a(this),b=c.attr("href"),b={content:{text:f(b)},
show:{event:"click"},hide:{fixed:!0,delay:150},style:{classes:"ui-tooltip-gitphp ui-tooltip-light ui-tooltip-shadow"},position:{viewport:a(window)}};c.qtip(b);c.click(function(){return!1})})})}});
define("modules/tooltip.commit",["jquery","modules/geturl","modules/getproject","modules/resources"],function(a,e,h,f){return function(d){d&&d.size()>0&&require(["qtip"],function(){d.each(function(){var c=a(this),b;(b=c.attr("href").match(/h=([0-9a-fA-F]{4,40}|HEAD)/))||(b=c.attr("href").match(/\/commits\/([0-9a-fA-F]{4,40}|HEAD)/));if(b=b?b[1]:null)b={content:{text:'<img src="'+e+'images/tooltip-loader.gif" alt="'+f.Loading+'" />',ajax:{url:e,data:{p:h,a:"commit",o:"jstip",h:b},type:"GET"}},style:{classes:"ui-tooltip-gitphp ui-tooltip-light ui-tooltip-shadow"},
position:{viewport:a(window)}},c.qtip(b)})})}});
define("modules/tooltip.tag",["jquery","modules/geturl","modules/getproject","modules/resources"],function(a,e,h,f){return function(d){d&&d.size()>0&&require(["qtip"],function(){d.each(function(){var c=a(this),b;(b=c.attr("href").match(/t=([^&]+)/))||(b=c.attr("href").match(/\/tags\/([^\/\?]+)/));if(b=b?b[1]:null)b={content:{text:'<img src="'+e+'images/tooltip-loader.gif" alt="'+f.Loading+'" />',ajax:{url:e,data:{p:h,a:"tag",o:"jstip",t:b},type:"GET"}},style:{classes:"ui-tooltip-gitphp ui-tooltip-light ui-tooltip-shadow"},
position:{viewport:a(window)}},c.qtip(b)})})}});define("common","jquery,modules/getproject,modules/lang,modules/tooltip.snapshot,modules/tooltip.commit,modules/tooltip.tag".split(","),function(a,e,h,f,d,c){a(function(){h(a("div.lang_select"));f(a("a.snapshotTip"))});e&&(d(a("a.commitTip")),c(a("a.tagTip")))});define("commitactivity",["jquery","modules/commitactivitygraph","common"],function(a,e){a(function(){e.init("div#graph")})});